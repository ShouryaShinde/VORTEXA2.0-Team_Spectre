<%- include("partials/header.ejs") %>

<div class="quiz-container">
  <% if(locals.questions) { %>
    <% questions.forEach((q, index) => { %>
  <div class="question-block" data-index="<%= index %>" <%= index === 0 ? "" : "style='display:none;'" %>>

        <!-- Question Number -->
        <div class="question-number">Question <%= index + 1 %></div>

        <!-- Question Box -->
        <div class="question-box"><%= q %></div>

        <!-- Options -->
        <div class="options-container">
          <% options[index].forEach((opt, i) => { %>
            <div class="option" data-q="<%= index %>" data-ans="<%= answers[index] %>" data-i="<%= i %>">
              <%= opt %>
            </div>
          <% }) %>
        </div>
      </div>
    <% }) %>
    
  <!-- Navigation -->
  <div class="quiz-navigation">
    <button id="prev-btn" class="nav-btn">Previous</button>
    <button id="next-btn" class="nav-btn">Next</button>
  </div>

  <!-- Score -->
  <div id="score-box" style="margin-top:1rem; font-weight:bold; color:#2563eb;"></div>
</div>
<script>
  let currentQuestion = 0;
  let score = 0;
  const questionBlocks = document.querySelectorAll(".question-block");
  const scoreBox = document.getElementById("score-box");

  function showQuestion(index) {
    questionBlocks.forEach((block, i) => {
      block.style.display = i === index ? "" : "none";
    });
  }

  // Option click handling
  document.querySelectorAll(".option").forEach(opt => {
    opt.addEventListener("click", () => {
      const correct = parseInt(opt.dataset.ans);
      const chosen = parseInt(opt.dataset.i);

      if (chosen === correct) {
        opt.style.backgroundColor = "green";
        opt.style.color = "white";
        score++;
      } else {
        opt.style.backgroundColor = "red";
        opt.style.color = "white";
      }

      // Disable options after click
      opt.parentElement.querySelectorAll(".option").forEach(btn => {
        btn.style.pointerEvents = "none";
      });

      scoreBox.textContent = `Score: ${score}/${questionBlocks.length}`;
    });
  });

  // Navigation buttons
  document.getElementById("next-btn").addEventListener("click", () => {
    if (currentQuestion < questionBlocks.length - 1) {
      currentQuestion++;
      showQuestion(currentQuestion);
    }
  });

  document.getElementById("prev-btn").addEventListener("click", () => {
    if (currentQuestion > 0) {
      currentQuestion--;
      showQuestion(currentQuestion);
    }
  });

  // Initialize
  showQuestion(currentQuestion);
</script>
<% } else { %>
<div class="container" >
    <h3 style="padding-top: 30px;"> Upload a File first to generate quiz </h3><br>
  <form>
    <input type = "submit" class ="btn btn-primary" value="Upload" formaction="/upload" method="GET">
  </form>
</div>
<% } %>
